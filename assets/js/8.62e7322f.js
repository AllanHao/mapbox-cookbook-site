(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{195:function(t,e,n){"use strict";n.d(e,"a",function(){return f});var i=n(57),o=n(58),r=n(61),s=n(60),a=n(81),l=n(62),c=n(122),u=n(77),p=n(102),f=function(t){function e(){return Object(i.a)(this,e),Object(r.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(l.a)(e,t),Object(o.a)(e,[{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(){}},{key:"setState",value:function(t){Object(a.a)(Object(s.a)(e.prototype),"setState",this).call(this,t),this.setLayerNeedsUpdate()}},{key:"getPickingInfo",value:function(t){return t.info}},{key:"renderLayers",value:function(){return null}},{key:"shouldRenderSubLayer",value:function(t,e){var n=this.props._subLayerProps;return e&&e.length||n&&n[t]}},{key:"getSubLayerClass",value:function(t,e){var n=this.props._subLayerProps;return n&&n[t]&&n[t].type||e}},{key:"getSubLayerProps",value:function(t){var e=this.props,n=e.opacity,i=e.pickable,o=e.visible,r=e.parameters,s=e.getPolygonOffset,a=e.highlightedObjectIndex,l=e.autoHighlight,c=e.highlightColor,u=e.coordinateSystem,p=e.coordinateOrigin,f=e.wrapLongitude,v=e.positionFormat,d=e.modelMatrix,h=e._subLayerProps,y={opacity:n,pickable:i,visible:o,parameters:r,getPolygonOffset:s,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:p,wrapLongitude:f,positionFormat:v,modelMatrix:d};if(t){var g=h&&h[t.id],x=g&&g.updateTriggers;Object.assign(y,t,g,{id:"".concat(this.props.id,"-").concat(t.id),updateTriggers:Object.assign({all:this.props.updateTriggers.all},t.updateTriggers,x)})}return y}},{key:"_getAttributeManager",value:function(){return null}},{key:"_renderLayers",value:function(){var t=this.internalState.subLayers;t&&!this.needsUpdate()?u.a.log(3,"Composite layer reused subLayers ".concat(this),this.internalState.subLayers)():(t=this.renderLayers(),t=Object(p.b)(t,{filter:Boolean}),this.internalState.subLayers=t,u.a.log(2,"Composite layer rendered new subLayers ".concat(this),t)());var e=!0,n=!1,i=void 0;try{for(var o,r=t[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){o.value.parent=this}}catch(t){n=!0,i=t}finally{try{e||null==r.return||r.return()}finally{if(n)throw i}}}},{key:"isComposite",get:function(){return!0}}]),e}(c.a);f.layerName="CompositeLayer"},245:function(t,e,n){"use strict";n.d(e,"a",function(){return p});var i=n(57),o=n(58),r=n(61),s=n(60),a=n(62),l=n(396),c=n(236),u=n(101),p=function(t){function e(t){var n;return Object(i.a)(this,e),(n=Object(r.a)(this,Object(s.a)(e).call(this,t))).projectedLight=new l.c(t),n}return Object(a.a)(e,t),Object(o.a)(e,[{key:"getProjectedLight",value:function(t){var e=t.layer,n=e.context.viewport,i=e.props,o=i.coordinateSystem,r=i.coordinateOrigin,s=Object(c.b)(this.position,{viewport:n,coordinateSystem:o,coordinateOrigin:r,fromCoordinateSystem:n.isGeospatial?u.a.LNGLAT:u.a.IDENTITY,fromCoordinateOrigin:[0,0,0]});return this.projectedLight.color=this.color,this.projectedLight.intensity=this.intensity,this.projectedLight.position=s,this.projectedLight}}]),e}(l.c)},343:function(t,e,n){var i=n(32);i(i.S,"Date",{now:function(){return(new Date).getTime()}})},344:function(t,e,n){"use strict";function i(t,e,n){n=n||2;var i,a,l,c,u,v,h,y=e&&e.length,g=y?e[0]*n:t.length,x=o(t,0,g,n,!0),P=[];if(!x||x.next===x.prev)return P;if(y&&(x=function(t,e,n,i){var s,a,l,c,u,v=[];for(s=0,a=e.length;s<a;s++)l=e[s]*i,c=s<a-1?e[s+1]*i:t.length,(u=o(t,l,c,i,!1))===u.next&&(u.steiner=!0),v.push(d(u));for(v.sort(p),s=0;s<v.length;s++)f(v[s],n),n=r(n,n.next);return n}(t,e,x,n)),t.length>80*n){i=l=t[0],a=c=t[1];for(var m=n;m<g;m+=n)(u=t[m])<i&&(i=u),(v=t[m+1])<a&&(a=v),u>l&&(l=u),v>c&&(c=v);h=0!==(h=Math.max(l-i,c-a))?1/h:0}return s(x,P,n,i,a,h),P}function o(t,e,n,i,o){var r,s;if(o===_(t,e,n,i)>0)for(r=e;r<n;r+=i)s=L(r,t[r],t[r+1],s);else for(r=n-i;r>=e;r-=i)s=L(r,t[r],t[r+1],s);return s&&x(s,s.next)&&(S(s),s=s.next),s}function r(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!x(i,i.next)&&0!==g(i.prev,i,i.next))i=i.next;else{if(S(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function s(t,e,n,i,o,p,f){if(t){!f&&p&&function(t,e,n,i){var o=t;do{null===o.z&&(o.z=v(o.x,o.y,e,n,i)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,n,i,o,r,s,a,l,c=1;do{for(n=t,t=null,r=null,s=0;n;){for(s++,i=n,a=0,e=0;e<c&&(a++,i=i.nextZ);e++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(o=n,n=n.nextZ,a--):(o=i,i=i.nextZ,l--),r?r.nextZ=o:t=o,o.prevZ=r,r=o;n=i}r.nextZ=null,c*=2}while(s>1)}(o)}(t,i,o,p);for(var d,h,y=t;t.prev!==t.next;)if(d=t.prev,h=t.next,p?l(t,i,o,p):a(t))e.push(d.i/n),e.push(t.i/n),e.push(h.i/n),S(t),t=h.next,y=h.next;else if((t=h)===y){f?1===f?s(t=c(t,e,n),e,n,i,o,p,2):2===f&&u(t,e,n,i,o,p):s(r(t),e,n,i,o,p,1);break}}}function a(t){var e=t.prev,n=t,i=t.next;if(g(e,n,i)>=0)return!1;for(var o=t.next.next;o!==t.prev;){if(h(e.x,e.y,n.x,n.y,i.x,i.y,o.x,o.y)&&g(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function l(t,e,n,i){var o=t.prev,r=t,s=t.next;if(g(o,r,s)>=0)return!1;for(var a=o.x<r.x?o.x<s.x?o.x:s.x:r.x<s.x?r.x:s.x,l=o.y<r.y?o.y<s.y?o.y:s.y:r.y<s.y?r.y:s.y,c=o.x>r.x?o.x>s.x?o.x:s.x:r.x>s.x?r.x:s.x,u=o.y>r.y?o.y>s.y?o.y:s.y:r.y>s.y?r.y:s.y,p=v(a,l,e,n,i),f=v(c,u,e,n,i),d=t.prevZ,y=t.nextZ;d&&d.z>=p&&y&&y.z<=f;){if(d!==t.prev&&d!==t.next&&h(o.x,o.y,r.x,r.y,s.x,s.y,d.x,d.y)&&g(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,y!==t.prev&&y!==t.next&&h(o.x,o.y,r.x,r.y,s.x,s.y,y.x,y.y)&&g(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(;d&&d.z>=p;){if(d!==t.prev&&d!==t.next&&h(o.x,o.y,r.x,r.y,s.x,s.y,d.x,d.y)&&g(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;y&&y.z<=f;){if(y!==t.prev&&y!==t.next&&h(o.x,o.y,r.x,r.y,s.x,s.y,y.x,y.y)&&g(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function c(t,e,n){var i=t;do{var o=i.prev,r=i.next.next;!x(o,r)&&P(o,i,i.next,r)&&m(o,r)&&m(r,o)&&(e.push(o.i/n),e.push(i.i/n),e.push(r.i/n),S(i),S(i.next),i=t=r),i=i.next}while(i!==t);return i}function u(t,e,n,i,o,a){var l=t;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&y(l,c)){var u=b(l,c);return l=r(l,l.next),u=r(u,u.next),s(l,e,n,i,o,a),void s(u,e,n,i,o,a)}c=c.next}l=l.next}while(l!==t)}function p(t,e){return t.x-e.x}function f(t,e){if(e=function(t,e){var n,i=e,o=t.x,r=t.y,s=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){var a=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=o&&a>s){if(s=a,a===o){if(r===i.y)return i;if(r===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(o===s)return n.prev;var l,c=n,u=n.x,p=n.y,f=1/0;i=n.next;for(;i!==c;)o>=i.x&&i.x>=u&&o!==i.x&&h(r<p?o:s,r,u,p,r<p?s:o,r,i.x,i.y)&&((l=Math.abs(r-i.y)/(o-i.x))<f||l===f&&i.x>n.x)&&m(i,t)&&(n=i,f=l),i=i.next;return n}(t,e)){var n=b(e,t);r(n,n.next)}}function v(t,e,n,i,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*o)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*o)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function d(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function h(t,e,n,i,o,r,s,a){return(o-s)*(e-a)-(t-s)*(r-a)>=0&&(t-s)*(i-a)-(n-s)*(e-a)>=0&&(n-s)*(r-a)-(o-s)*(i-a)>=0}function y(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&P(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&m(t,e)&&m(e,t)&&function(t,e){var n=t,i=!1,o=(t.x+e.x)/2,r=(t.y+e.y)/2;do{n.y>r!=n.next.y>r&&n.next.y!==n.y&&o<(n.next.x-n.x)*(r-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)}function g(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function x(t,e){return t.x===e.x&&t.y===e.y}function P(t,e,n,i){return!!(x(t,e)&&x(n,i)||x(t,i)&&x(n,e))||g(t,e,n)>0!=g(t,e,i)>0&&g(n,i,t)>0!=g(n,i,e)>0}function m(t,e){return g(t.prev,t,t.next)<0?g(t,e,t.next)>=0&&g(t,t.prev,e)>=0:g(t,e,t.prev)<0||g(t,t.next,e)<0}function b(t,e){var n=new w(t.i,t.x,t.y),i=new w(e.i,e.x,e.y),o=t.next,r=e.prev;return t.next=e,e.prev=t,n.next=o,o.prev=n,i.next=n,n.prev=i,r.next=i,i.prev=r,i}function L(t,e,n,i){var o=new w(t,e,n);return i?(o.next=i.next,o.prev=i,i.next.prev=o,i.next=o):(o.prev=o,o.next=o),o}function S(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function w(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function _(t,e,n,i){for(var o=0,r=e,s=n-i;r<n;r+=i)o+=(t[s]-t[r])*(t[r+1]+t[s+1]),s=r;return o}t.exports=i,t.exports.default=i,i.deviation=function(t,e,n,i){var o=e&&e.length,r=o?e[0]*n:t.length,s=Math.abs(_(t,0,r,n));if(o)for(var a=0,l=e.length;a<l;a++){var c=e[a]*n,u=a<l-1?e[a+1]*n:t.length;s-=Math.abs(_(t,c,u,n))}var p=0;for(a=0;a<i.length;a+=3){var f=i[a]*n,v=i[a+1]*n,d=i[a+2]*n;p+=Math.abs((t[f]-t[d])*(t[v+1]-t[f+1])-(t[f]-t[v])*(t[d+1]-t[f+1]))}return 0===s&&0===p?0:Math.abs((p-s)/s)},i.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,o=0;o<t.length;o++){for(var r=0;r<t[o].length;r++)for(var s=0;s<e;s++)n.vertices.push(t[o][r][s]);o>0&&(i+=t[o-1].length,n.holes.push(i))}return n}},371:function(t,e,n){"use strict";var i=n(57),o=n(58),r=n(61),s=n(60),a=n(81),l=n(62),c=n(122),u=n(251),p=n(342),f=n(78),v=n(422),d=f.a.Tesselator,h=v.a.fp64LowPart,y=function(t){function e(t){var n=t.data,o=t.getGeometry,a=t.positionFormat,l=t.fp64;return Object(i.a)(this,e),Object(r.a)(this,Object(s.a)(e).call(this,{data:n,getGeometry:o,fp64:l,positionFormat:a,attributes:{startPositions:{size:3},endPositions:{size:3},leftPositions:{size:3},rightPositions:{size:3},startEndPositions64XyLow:{size:4,fp64Only:!0},neighborPositions64XyLow:{size:4,fp64Only:!0}}}))}return Object(l.a)(e,t),Object(o.a)(e,[{key:"get",value:function(t){return this.attributes[t]}},{key:"getGeometrySize",value:function(t){return Math.max(0,this.getPathLength(t)-1)}},{key:"updateGeometryAttributes",value:function(t,e){var n=this.attributes,i=n.startPositions,o=n.endPositions,r=n.leftPositions,s=n.rightPositions,a=n.startEndPositions64XyLow,l=n.neighborPositions64XyLow,c=this.fp64,u=e.geometrySize+1;if(!(u<2))for(var p,f=this.isClosed(t),v=this.getPointOnPath(t,0),d=this.getPointOnPath(t,1),y=f?this.getPointOnPath(t,u-2):v,g=e.vertexStart,x=1;x<u;g++,x++)p=x+1<u?this.getPointOnPath(t,x+1):f?this.getPointOnPath(t,1):d,i[3*g]=v[0],i[3*g+1]=v[1],i[3*g+2]=v[2]||0,o[3*g]=d[0],o[3*g+1]=d[1],o[3*g+2]=d[2]||0,r[3*g]=y[0],r[3*g+1]=y[1],r[3*g+2]=y[2]||0,s[3*g]=p[0],s[3*g+1]=p[1],s[3*g+2]=p[2]||0,c&&(a[4*g]=h(v[0]),a[4*g+1]=h(v[1]),a[4*g+2]=h(d[0]),a[4*g+3]=h(d[1]),l[4*g]=h(y[0]),l[4*g+1]=h(y[1]),l[4*g+2]=h(p[0]),l[4*g+3]=h(p[1])),y=v,v=d,d=p}},{key:"getPathLength",value:function(t){return Number.isFinite(t[0])?t.length/this.positionSize:t.length}},{key:"getPointOnPath",value:function(t,e){if(Number.isFinite(t[0])){var n=this.positionSize;return[t[e*n],t[e*n+1],3===n?t[e*n+2]:0]}return t[e]}},{key:"isClosed",value:function(t){var e=this.getPathLength(t),n=this.getPointOnPath(t,0),i=this.getPointOnPath(t,e-1);return n[0]===i[0]&&n[1]===i[1]&&n[2]===i[2]}}]),e}(d),g="#define SHADER_NAME path-layer-fragment-shader\n\nprecision highp float;\n\nuniform float jointType;\nuniform float miterLimit;\nuniform float alignMode;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vDashArray;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nfloat mod2(float a, float b) {\n  return a - floor(a / b) * b;\n}\n\nfloat round(float x) {\n  return floor(x + 0.5);\n}\nbool dash_isFragInGap() {\n  float solidLength = vDashArray.x;\n  float gapLength = vDashArray.y;\n\n  float unitLength = solidLength + gapLength;\n\n  if (unitLength == 0.0) {\n    return false;\n  }\n\n  unitLength = mix(\n    unitLength,\n    vPathLength / round(vPathLength / unitLength),\n    alignMode\n  );\n\n  float offset = alignMode * solidLength / 2.0;\n\n  return gapLength > 0.0 &&\n    vPathPosition.y >= 0.0 &&\n    vPathPosition.y <= vPathLength &&\n    mod2(vPathPosition.y + offset, unitLength) > solidLength;\n}\n\nvoid main(void) {\n  if (jointType > 0.0 && vMiterLength > 0.0 && length(vCornerOffset) > 1.0) {\n    discard;\n  }\n  if (jointType == 0.0 && vMiterLength > miterLimit) {\n    discard;\n  }\n  if (vColor.a == 0.0 || dash_isFragInGap()) {\n    discard;\n  }\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n";n.d(e,"a",function(){return b});var x=[0,0,0,255],P={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},rounded:!1,miterLimit:{type:"number",min:0,value:4},fp64:!1,dashJustified:!1,billboard:!1,getPath:{type:"accessor",value:function(t){return t.path}},getColor:{type:"accessor",value:x},getWidth:{type:"accessor",value:1},getDashArray:{type:"accessor",value:[0,0]}},m={enter:function(t,e){return e.length?e.subarray(e.length-t.length):t}},b=function(t){function e(){return Object(i.a)(this,e),Object(r.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(l.a)(e,t),Object(o.a)(e,[{key:"getShaders",value:function(){return this.use64bitProjection()?{vs:"\n#define SHADER_NAME path-layer-vertex-shader-64\n\nattribute vec3 positions;\n\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec4 instanceStartEndPositions64xyLow;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec4 instanceNeighborPositions64xyLow;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec2 instanceDashArrays;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float miterLimit;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vDashArray;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\nconst float EPSILON = 0.001;\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\n\nvec3 lineJoin(vec2 prevPoint64[2], vec2 currPoint64[2], vec2 nextPoint64[2]) {\n\n  float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0;\n  float width = project_pixel_size(widthPixels);\n\n  vec2 deltaA64[2];\n  vec2 deltaB64[2];\n\n  vec2_sub_fp64(currPoint64, prevPoint64, deltaA64);\n  vec2_sub_fp64(nextPoint64, currPoint64, deltaB64);\n\n  vec2 lengthA64 = vec2_length_fp64(deltaA64);\n  vec2 lengthB64 = vec2_length_fp64(deltaB64);\n\n  vec2 deltaA = vec2(deltaA64[0].x, deltaA64[1].x);\n  vec2 deltaB = vec2(deltaB64[0].x, deltaB64[1].x);\n\n  float lenA = lengthA64.x;\n  float lenB = lengthB64.x;\n\n  vec2 offsetVec;\n  float offsetScale;\n  float offsetDirection;\n  lenA = lenA / width > EPSILON ? lenA : 0.0;\n  lenB = lenB / width > EPSILON ? lenB : 0.0;\n  vec2 dirA = lenA > 0. ? deltaA / lenA : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? deltaB / lenB : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n  vec2 tangent = vec2(dirA + dirB);\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  vec2 perp = mix(perpB, perpA, positions.x);\n  float L = mix(lenB, lenA, positions.x);\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n  bool turnsRight = dirA.x * dirB.y > dirA.y * dirB.x;\n  float cornerPosition = mix(\n    flipIfTrue(turnsRight == (positions.y > 0.0)),\n    0.0,\n    positions.z\n  );\n\n  offsetScale = 1.0 / max(sinHalfA, EPSILON);\n  cornerPosition *= float(cornerPosition <= 0.0 || sinHalfA < min(lenA, lenB) / width * cosHalfA);\n  offsetScale = mix(\n    offsetScale,\n    min(offsetScale, L / width / max(cosHalfA, EPSILON)),\n    float(cornerPosition < 0.0)\n  );\n\n  vMiterLength = mix(\n    offsetScale * cornerPosition,\n    mix(offsetScale, 0.0, cornerPosition),\n    step(0.0, cornerPosition)\n  ) - sinHalfA * jointType;\n  offsetDirection = mix(\n    positions.y,\n    mix(\n      flipIfTrue(turnsRight),\n      positions.y * flipIfTrue(turnsRight == (positions.x == 1.)),\n      cornerPosition\n    ),\n    step(0.0, cornerPosition)\n  );\n  offsetVec = mix(miterVec, -tangent, step(0.5, cornerPosition));\n  offsetScale = mix(offsetScale, 1.0 / max(cosHalfA, 0.001), step(0.5, cornerPosition));\n  float isStartCap = step(lenA, 1.0e-5);\n  float isEndCap = step(lenB, 1.0e-5);\n  float isCap = max(isStartCap, isEndCap);\n  cornerPosition = isCap * (1.0 - positions.z);\n  offsetVec = mix(offsetVec, mix(dirB, perpB, cornerPosition), isStartCap);\n  offsetVec = mix(offsetVec, mix(dirA, perpA, cornerPosition), isEndCap);\n  offsetScale = mix(\n    offsetScale,\n    mix(4.0 * jointType, 1.0, cornerPosition),\n    isCap\n  );\n  vMiterLength = mix(vMiterLength, 1.0 - cornerPosition, isCap);\n\n  offsetDirection = mix(\n    offsetDirection,\n    mix(flipIfTrue(isStartCap > 0.), positions.y, cornerPosition),\n    isCap\n  );\n\n  vCornerOffset = offsetVec * offsetDirection * offsetScale;\n  vDashArray = instanceDashArrays;\n  vPathLength = L / width;\n  float isEnd = positions.x;\n  vec2 offsetFromStartOfPath = mix(vCornerOffset, vCornerOffset + deltaA / width, isEnd);\n  vec2 dir = mix(dirB, dirA, isEnd);\n  vPathPosition = vec2(\n    positions.y + positions.z * offsetDirection,\n    dot(offsetFromStartOfPath, dir)\n  );\n\n  return vec3(vCornerOffset * width, 0.0);\n}\n\nvoid main() {\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  picking_setPickingColor(instancePickingColors);\n\n  float isEnd = positions.x;\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec2 currPosition64xyLow = mix(instanceStartEndPositions64xyLow.xy, instanceStartEndPositions64xyLow.zw, isEnd);\n  vec2 projected_curr_position[2];\n  project_position_fp64(currPosition.xy, currPosition64xyLow, projected_curr_position);\n  float projected_curr_position_z = project_size(currPosition.z);\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec2 prevPosition64xyLow = mix(instanceNeighborPositions64xyLow.xy, instanceStartEndPositions64xyLow.xy, isEnd);\n\n  vec2 projected_prev_position[2];\n  project_position_fp64(prevPosition.xy, prevPosition64xyLow, projected_prev_position);\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec2 nextPosition64xyLow = mix(instanceStartEndPositions64xyLow.zw, instanceNeighborPositions64xyLow.zw, isEnd);\n\n  vec2 projected_next_position[2];\n  project_position_fp64(nextPosition.xy, nextPosition64xyLow, projected_next_position);\n\n  vec3 pos = lineJoin(projected_prev_position, projected_curr_position, projected_next_position);\n  vec2 vertex_pos_modelspace[4];\n\n  vertex_pos_modelspace[0] = sum_fp64(vec2(pos.x, 0.0), projected_curr_position[0]);\n  vertex_pos_modelspace[1] = sum_fp64(vec2(pos.y, 0.0), projected_curr_position[1]);\n  vertex_pos_modelspace[2] = vec2(pos.z + projected_curr_position_z, 0.0);\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_common_position_to_clipspace_fp64(vertex_pos_modelspace);\n}\n",fs:g,modules:["project64","picking"]}:{vs:"#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec4 instanceStartEndPositions64xyLow;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec4 instanceNeighborPositions64xyLow;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec2 instanceDashArrays;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float miterLimit;\nuniform bool billboard;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vDashArray;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\nvec3 lineJoin(\n  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,\n  float relativePosition, bool isEnd, bool isJoint,\n  vec2 width\n) {\n  vec2 deltaA = (currPoint.xy - prevPoint.xy) / width;\n  vec2 deltaB = (nextPoint.xy - currPoint.xy) / width;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n  lenA = lenA > EPSILON ? lenA : 0.0;\n  lenB = lenB > EPSILON ? lenB : 0.0;\n\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n  vec2 tangent = vec2(dirA + dirB);\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  vec2 perp = isEnd ? perpA : perpB;\n  float L = isEnd ? lenA : lenB;\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n\n  bool turnsRight = dirA.x * dirB.y > dirA.y * dirB.x;\n\n  float offsetScale = 1.0 / max(sinHalfA, EPSILON);\n\n  float cornerPosition = isJoint ?\n    0.0 :\n    flipIfTrue(turnsRight == (relativePosition > 0.0));\n  cornerPosition *=\n    float(cornerPosition <= 0.0 || sinHalfA < min(lenA, lenB) * cosHalfA);\n  if (cornerPosition < 0.0) {\n    offsetScale = min(offsetScale, L / max(cosHalfA, EPSILON));\n  }\n\n  vMiterLength = cornerPosition >= 0.0 ?\n    mix(offsetScale, 0.0, cornerPosition) :\n    offsetScale * cornerPosition;\n  vMiterLength -= sinHalfA * jointType;\n\n  float offsetDirection = mix(\n    positions.y,\n    mix(\n      flipIfTrue(turnsRight),\n      positions.y * flipIfTrue(turnsRight == (positions.x == 1.)),\n      cornerPosition\n    ),\n    step(0.0, cornerPosition)\n  );\n\n  vec2 offsetVec = mix(miterVec, -tangent, step(0.5, cornerPosition));\n  offsetScale = mix(offsetScale, 1.0 / max(cosHalfA, 0.001), step(0.5, cornerPosition));\n  bool isStartCap = step(0.0, -lenA) > 0.5;\n  bool isEndCap = step(0.0, -lenB) > 0.5;\n  bool isCap = isStartCap || isEndCap;\n  cornerPosition = isCap ? (1.0 - positions.z) : 0.;\n  if (isStartCap) {\n    offsetVec = mix(dirB, perpB, cornerPosition);\n  }\n  if (isEndCap) {\n    offsetVec = mix(dirA, perpA, cornerPosition);\n  }\n  if (isCap) {\n    offsetScale = mix(4.0 * jointType, 1.0, cornerPosition);\n    vMiterLength = 1.0 - cornerPosition;\n    offsetDirection = mix(flipIfTrue(isStartCap), positions.y, cornerPosition);\n  }\n\n  vCornerOffset = offsetVec * offsetDirection * offsetScale;\n  vDashArray = instanceDashArrays;\n  vPathLength = L;\n  vec2 offsetFromStartOfPath = vCornerOffset;\n  if (isEnd) {\n    offsetFromStartOfPath += deltaA;\n  }\n  vec2 dir = isEnd ? dirA : dirB;\n  vPathPosition = vec2(\n    positions.y + positions.z * offsetDirection,\n    dot(offsetFromStartOfPath, dir)\n  );\n\n  return currPoint + vec3(vCornerOffset * width, 0.0);\n}\nvec3 lineJoin(vec3 prevPoint, vec3 currPoint, vec3 nextPoint) {\n\n  float relativePosition = positions.y;\n  bool isEnd = positions.x > EPSILON;\n  bool isJoint = positions.z > EPSILON;\n\n  vec2 widthPixels = vec2(clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0);\n\n  return lineJoin(\n    prevPoint, currPoint, nextPoint,\n    relativePosition, isEnd, isJoint,\n    billboard ? project_pixel_size_to_clipspace(widthPixels) : project_pixel_size(widthPixels)\n  );\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\n  if (position.w < EPSILON) {\n    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\n    position = refPosition + (position - refPosition) * r;\n  }\n}\n\nvoid main() {\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  picking_setPickingColor(instancePickingColors);\n\n  float isEnd = positions.x;\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec2 prevPosition64xyLow = mix(instanceNeighborPositions64xyLow.xy, instanceStartEndPositions64xyLow.xy, isEnd);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec2 currPosition64xyLow = mix(instanceStartEndPositions64xyLow.xy, instanceStartEndPositions64xyLow.zw, isEnd);\n\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec2 nextPosition64xyLow = mix(instanceStartEndPositions64xyLow.zw, instanceNeighborPositions64xyLow.zw, isEnd);\n\n  if (billboard) {\n    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64xyLow, ZERO_OFFSET);\n    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64xyLow, ZERO_OFFSET);\n    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64xyLow, ZERO_OFFSET);\n\n    clipLine(prevPositionScreen, currPositionScreen);\n    clipLine(nextPositionScreen, currPositionScreen);\n    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\n\n    vec3 pos = lineJoin(\n      prevPositionScreen.xyz / prevPositionScreen.w,\n      currPositionScreen.xyz / currPositionScreen.w,\n      nextPositionScreen.xyz / nextPositionScreen.w\n    );\n\n    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);\n  } else {\n    prevPosition = project_position(prevPosition, prevPosition64xyLow);\n    currPosition = project_position(currPosition, currPosition64xyLow);\n    nextPosition = project_position(nextPosition, nextPosition64xyLow);\n\n    vec3 pos = lineJoin(prevPosition, currPosition, nextPosition);\n    gl_Position = project_common_position_to_clipspace(vec4(pos, 1.0));\n  }\n}\n",fs:g,modules:["project32","picking"]}}},{key:"initializeState",value:function(){var t=this;this.getAttributeManager().addInstanced({instanceStartPositions:{size:3,transition:m,accessor:"getPath",update:this.calculateStartPositions,noAlloc:!0},instanceEndPositions:{size:3,transition:m,accessor:"getPath",update:this.calculateEndPositions,noAlloc:!0},instanceStartEndPositions64xyLow:{size:4,update:this.calculateInstanceStartEndPositions64xyLow,noAlloc:!0},instanceLeftPositions:{size:3,accessor:"getPath",update:this.calculateLeftPositions,noAlloc:!0},instanceRightPositions:{size:3,accessor:"getPath",update:this.calculateRightPositions,noAlloc:!0},instanceNeighborPositions64xyLow:{size:4,update:this.calculateInstanceNeighborPositions64xyLow,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:m,defaultValue:1},instanceDashArrays:{size:2,accessor:"getDashArray"},instanceColors:{size:4,type:5121,accessor:"getColor",transition:m,defaultValue:x},instancePickingColors:{size:3,type:5121,accessor:function(e,n){var i=n.index,o=n.target;return t.encodePickingColor(i,o)}}}),this.setState({pathTesselator:new y({})})}},{key:"updateState",value:function(t){var n=t.oldProps,i=t.props,o=t.changeFlags;Object(a.a)(Object(s.a)(e.prototype),"updateState",this).call(this,{props:i,oldProps:n,changeFlags:o});var r=this.getAttributeManager();if(o.dataChanged||i.fp64!==n.fp64||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getPath)){var l=this.state.pathTesselator;l.updateGeometry({data:i.data,getGeometry:i.getPath,positionFormat:i.positionFormat,fp64:this.use64bitPositions()}),this.setState({numInstances:l.instanceCount,bufferLayout:l.bufferLayout}),r.invalidateAll()}if(i.fp64!==n.fp64){var c=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(c)}),r.invalidateAll()}}},{key:"draw",value:function(t){var e=t.uniforms,n=this.context.viewport,i=this.props,o=i.rounded,r=i.billboard,s=i.miterLimit,a=i.widthUnits,l=i.widthScale,c=i.widthMinPixels,u=i.widthMaxPixels,p=i.dashJustified,f="pixels"===a?n.distanceScales.metersPerPixel[2]:1;this.state.model.setUniforms(Object.assign({},e,{jointType:Number(o),billboard:r,alignMode:Number(p),widthScale:l*f,miterLimit:s,widthMinPixels:c,widthMaxPixels:u})).draw()}},{key:"_getModel",value:function(t){return new u.a(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new p.a({drawMode:4,attributes:{indices:new Uint16Array([0,2,1,1,2,4,1,4,3,3,4,5]),positions:new Float32Array([0,0,1,0,-1,0,0,1,0,1,-1,0,1,1,0,1,0,1])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"calculateStartPositions",value:function(t){var e=this.state.pathTesselator;t.bufferLayout=e.bufferLayout,t.value=e.get("startPositions")}},{key:"calculateEndPositions",value:function(t){var e=this.state.pathTesselator;t.bufferLayout=e.bufferLayout,t.value=e.get("endPositions")}},{key:"calculateInstanceStartEndPositions64xyLow",value:function(t){var e=this.use64bitPositions();t.constant=!e,t.value=e?this.state.pathTesselator.get("startEndPositions64XyLow"):new Float32Array(4)}},{key:"calculateLeftPositions",value:function(t){var e=this.state.pathTesselator;t.value=e.get("leftPositions")}},{key:"calculateRightPositions",value:function(t){var e=this.state.pathTesselator;t.value=e.get("rightPositions")}},{key:"calculateInstanceNeighborPositions64xyLow",value:function(t){var e=this.use64bitPositions();t.constant=!e,t.value=e?this.state.pathTesselator.get("neighborPositions64XyLow"):new Float32Array(4)}},{key:"clearPickingColor",value:function(t){for(var e=this.decodePickingColor(t),n=this.state.pathTesselator.bufferLayout,i=n[e],o=0,r=0;r<e;r++)o+=n[r];var s=this.getAttributeManager().attributes.instancePickingColors,a=s.value,l=o+i;a.fill(0,3*o,3*l),s.update({value:a})}}]),e}(c.a);b.layerName="PathLayer",b.defaultProps=P},377:function(t,e,n){"use strict";var i=n(57),o=n(61),r=n(60),s=n(80),a=n(62);n.d(e,"a",function(){return c});var l={ambient:.35,diffuse:.6,shininess:32,specularColor:[30,30,30]},c=function(t){function e(t){var n;return Object(i.a)(this,e),n=Object(o.a)(this,Object(r.a)(e).call(this,t)),t=Object.assign({},l,t),Object.assign(Object(s.a)(n),t),n}return Object(a.a)(e,t),e}(function t(){Object(i.a)(this,t)})},398:function(t,e,n){"use strict";n.d(e,"a",function(){return p});var i=n(57),o=n(58),r=n(61),s=n(60),a=n(81),l=n(62),c=n(371),u=n(140),p=function(t){function e(){return Object(i.a)(this,e),Object(r.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(l.a)(e,t),Object(o.a)(e,[{key:"getShaders",value:function(){var t=Object(a.a)(Object(s.a)(e.prototype),"getShaders",this).call(this);return t.inject={"vs:#decl":"uniform float trailLength;\nuniform bool isPath3D;\nattribute vec2 instanceTimestamps;\nvarying float vTime;\n","vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);":"vec2 timestamps = instanceTimestamps;\nif (!isPath3D) {\n  prevPosition.z = 0.0;\n  currPosition.z = 0.0;\n  nextPosition.z = 0.0;\n  timestamps.x = instanceStartPositions.z;\n  timestamps.y = instanceEndPositions.z;\n}\n","vs:#main-end":"float shiftZ = sin(timestamps.x) * 1e-4;\ngl_Position.z += shiftZ;\nvTime = timestamps.x + (timestamps.y - timestamps.x) * vPathPosition.y / vPathLength;\n","fs:#decl":"uniform float trailLength;\nuniform float currentTime;\nvarying float vTime;\n","fs:#main-start":"if(vTime > currentTime || vTime < currentTime - trailLength) {\n  discard;\n}\n","gl_FragColor = vColor;":"gl_FragColor.a *= 1.0 - (currentTime - vTime) / trailLength;"},t}},{key:"initializeState",value:function(t){Object(a.a)(Object(s.a)(e.prototype),"initializeState",this).call(this,t),this.getAttributeManager().addInstanced({instanceTimestamps:{size:2,update:this.calculateInstanceTimestamps}})}},{key:"draw",value:function(t){var n=this.props,i=n.trailLength,o=n.currentTime,r=n.getTimestamps;t.uniforms=Object.assign({},t.uniforms,{trailLength:i,currentTime:o,isPath3D:Boolean(r)}),Object(a.a)(Object(s.a)(e.prototype),"draw",this).call(this,t)}},{key:"calculateInstanceTimestamps",value:function(t,e){var n=e.startRow,i=e.endRow,o=this.props,r=o.data,s=o.getTimestamps;if(!s)return t.constant=!0,void(t.value=new Float32Array(2));for(var a=this.state.pathTesselator,l=a.bufferLayout,c=a.instanceCount,p=new Float32Array(2*c),f=Object(u.a)(r,n,i),v=f.iterable,d=f.objectInfo,h=0,y=0;y<n;y++)h+=2*l[y];var g=!0,x=!1,P=void 0;try{for(var m,b=v[Symbol.iterator]();!(g=(m=b.next()).done);g=!0){var L=m.value;d.index++;for(var S=l[d.index],w=s(L,d),_=0;_<S;_++)p[h++]=w[_],p[h++]=w[_+1]}}catch(t){x=!0,P=t}finally{try{g||null==b.return||b.return()}finally{if(x)throw P}}t.constant=!1,t.value=p}}]),e}(c.a);p.layerName="TripsLayer",p.defaultProps={trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:null}}},402:function(t,e,n){"use strict";var i=n(57),o=n(58),r=n(61),s=n(60),a=n(62),l=n(377),c=n(140),u=n(195),p=n(81),f=n(122),v=n(389),d=n(337),h=n(251),y=n(342),g=n(344),x=n.n(g);function P(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function m(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function b(t){var e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function L(t,e,n,i){for(var o=0;o<e;o++)if(t[n+o]!==t[i-e+o])return!1;return!0}function S(t,e,n,i){for(var o=e,r=n.length,s=0;s<r;s++)for(var a=0;a<i;a++)t[o++]=n[s][a]||0;if(!b(n))for(var l=0;l<i;l++)t[o++]=n[0][l]||0;return o}function w(t,e,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5?arguments[5]:void 0,s=(r=r||n.length)-o;if(s<=0)return e;for(var a=e,l=0;l<s;l++)t[a++]=n[o+l];if(!L(n,i,o,r))for(var c=0;c<i;c++)t[a++]=n[o+c];return a}function _(t){return(b(t)?0:1)+t.length}function C(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;return n>=(i=i||t.length)?0:(L(t,e,n,i)?0:1)+(i-n)/e}function A(t,e){if(P(t),t.positions){var n=t,i=n.positions,o=n.holeIndices;if(o){for(var r=0,s=0;s<=o.length;s++)r+=C(t.positions,e,o[s-1],o[s]);return r}t=i}if(Number.isFinite(t[0]))return C(t,e);if(!m(t)){var a=0,l=!0,c=!1,u=void 0;try{for(var p,f=t[Symbol.iterator]();!(l=(p=f.next()).done);l=!0){a+=_(p.value)}}catch(t){c=!0,u=t}finally{try{l||null==f.return||f.return()}finally{if(c)throw u}}return a}return _(t)}function j(t,e,n){P(t),n=n||A(t,e);var i=new Float64Array(n*e),o=[];if(t.positions){var r=t,s=r.positions,a=r.holeIndices;if(a){for(var l=0,c=0;c<=a.length;c++)l=w(i,l,s,e,a[c-1],a[c]),o.push(l);return o.pop(),{positions:i,holeIndices:o}}t=s}if(Number.isFinite(t[0]))return w(i,0,t,e),{positions:i,holeIndices:null};if(!m(t)){var u=0,p=!0,f=!1,v=void 0;try{for(var d,h=t[Symbol.iterator]();!(p=(d=h.next()).done);p=!0){u=S(i,u,d.value,e),o.push(u)}}catch(t){f=!0,v=t}finally{try{p||null==h.return||h.return()}finally{if(f)throw v}}return o.pop(),{positions:i,holeIndices:o}}return S(i,0,t,e),{positions:i,holeIndices:null}}var O=n(78),E=n(422),k=O.a.Tesselator,T=E.a.fp64LowPart,z=function(t){function e(t){var n=t.data,o=t.getGeometry,a=t.fp64,l=t.positionFormat,c=t.IndexType,u=void 0===c?Uint32Array:c;return Object(i.a)(this,e),Object(r.a)(this,Object(s.a)(e).call(this,{data:n,getGeometry:o,fp64:a,positionFormat:l,attributes:{positions:{size:3},positions64xyLow:{size:2,fp64Only:!0},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:u,size:1}}}))}return Object(a.a)(e,t),Object(o.a)(e,[{key:"get",value:function(t){return"indices"===t?this.attributes.indices.subarray(0,this.vertexCount):this.attributes[t]}},{key:"getGeometrySize",value:function(t){return A(t,this.positionSize)}},{key:"updateGeometryAttributes",value:function(t,e){t=j(t,this.positionSize,e.geometrySize),this._updateIndices(t,e),this._updatePositions(t,e)}},{key:"_updateIndices",value:function(t,e){var n,i,o,r=e.geometryIndex,s=e.vertexStart,a=e.indexStart,l=this.attributes,c=this.indexLayout,u=this.typedArrayManager,p=l.indices,f=p.length,v=a,d=(n=t,i=this.positionSize,o=null,n.holeIndices&&(o=n.holeIndices.map(function(t){return t/i})),x()(n.positions,o,i));f<v+d.length&&(f=2*(v+d.length),p=u.allocate(p,f,{type:p.constructor,size:1,copy:!0}));for(var h=0;h<d.length;h++)p[v++]=d[h]+s;c[r]=d.length,l.indices=p}},{key:"_updatePositions",value:function(t,e){for(var n=e.vertexStart,i=e.geometrySize,o=this.attributes,r=o.positions,s=o.positions64xyLow,a=o.vertexValid,l=this.fp64,c=this.positionSize,u=n,p=t.positions,f=t.holeIndices,v=0;v<i;v++){var d=p[v*c],h=p[v*c+1],y=c>2?p[v*c+2]:0;r[3*u]=d,r[3*u+1]=h,r[3*u+2]=y,l&&(s[2*u]=T(d),s[2*u+1]=T(h)),a[u]=1,u++}if(f)for(var g=0;g<f.length;g++)a[n+f[g]/c-1]=0;a[n+i-1]=0}}]),e}(k),M="\nattribute vec2 vertexPositions;\nattribute float vertexValid;\n\nuniform bool extruded;\nuniform bool isWireframe;\nuniform float elevationScale;\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying float isValid;\n\nstruct PolygonProps {\n  vec4 fillColors;\n  vec4 lineColors;\n  vec3 positions;\n  vec3 nextPositions;\n  vec3 pickingColors;\n  vec2 positions64xyLow;\n  vec2 nextPositions64xyLow;\n  float elevations;\n};\n\nvec3 project_offset_normal(vec3 vector) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNG_LAT ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_AUTO_OFFSET) {\n    return normalize(vector * project_uCommonUnitsPerWorldUnit);\n  }\n  return project_normal(vector);\n}\n\nvoid calculatePosition(PolygonProps props) {\n  vec3 pos;\n  vec2 pos64xyLow;\n  vec3 normal;\n  vec4 colors = isWireframe ? props.lineColors : props.fillColors;\n\n#ifdef IS_SIDE_VERTEX\n  pos = mix(props.positions, props.nextPositions, vertexPositions.x);\n  pos64xyLow = mix(props.positions64xyLow, props.nextPositions64xyLow, vertexPositions.x);\n  isValid = vertexValid;\n#else\n  pos = props.positions;\n  pos64xyLow = props.positions64xyLow;\n  isValid = 1.0;\n#endif\n\n  if (extruded) {\n    pos.z += props.elevations * vertexPositions.y * elevationScale;\n  }\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(pos, pos64xyLow, vec3(0.), position_commonspace);\n\n  if (extruded) {\n#ifdef IS_SIDE_VERTEX\n    normal = vec3(props.positions.y - props.nextPositions.y, props.nextPositions.x - props.positions.x, 0.0);\n    normal = project_offset_normal(normal);\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n\n    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, position_commonspace.xyz, normal);\n    vColor = vec4(lightColor, colors.a * opacity) / 255.0;\n  } else {\n    vColor = vec4(colors.rgb, colors.a * opacity) / 255.0;\n  }\n  picking_setPickingColor(props.pickingColors);\n}\n",I="#define SHADER_NAME solid-polygon-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec2 positions64xyLow;\nattribute float elevations;\nattribute vec4 fillColors;\nattribute vec4 lineColors;\nattribute vec3 pickingColors;\n\n".concat(M,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = positions;\n  props.positions64xyLow = positions64xyLow;\n  props.elevations = elevations;\n  props.fillColors = fillColors;\n  props.lineColors = lineColors;\n  props.pickingColors = pickingColors;\n\n  calculatePosition(props);\n}\n"),F="#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\n\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute vec3 nextPositions;\nattribute vec2 nextPositions64xyLow;\nattribute float instanceElevations;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\n".concat(M,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = instancePositions;\n  props.positions64xyLow = instancePositions64xyLow;\n  props.elevations = instanceElevations;\n  props.fillColors = instanceFillColors;\n  props.lineColors = instanceLineColors;\n  props.pickingColors = instancePickingColors;\n  props.nextPositions = nextPositions;\n  props.nextPositions64xyLow = nextPositions64xyLow;\n\n  calculatePosition(props);\n}\n"),N=[0,0,0,255],B=new l.a,D={filled:!0,extruded:!1,wireframe:!1,fp64:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:function(t){return t.polygon}},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:N},getLineColor:{type:"accessor",value:N},material:B},R={enter:function(t,e){return e.length?e.subarray(e.length-t.length):t}},V=function(t){function e(){return Object(i.a)(this,e),Object(r.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(a.a)(e,t),Object(o.a)(e,[{key:"getShaders",value:function(t){return{vs:t,fs:"#define SHADER_NAME solid-polygon-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying float isValid;\n\nvoid main(void) {\n  if (isValid < 0.5) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",defines:{},modules:[this.use64bitProjection()?"project64":"project32","gouraud-lighting","picking"]}}},{key:"initializeState",value:function(){var t=this,e=this.context.gl;this.setState({numInstances:0,polygonTesselator:new z({IndexType:!e||Object(v.b)(e,d.a.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});var n=this.getAttributeManager();n.remove(["instancePickingColors"]),n.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:!0},positions:{size:3,transition:R,accessor:"getPolygon",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{positions:{offset:0,divisor:0},instancePositions:{offset:0,divisor:1},nextPositions:{offset:12,divisor:1}}},positions64xyLow:{size:2,update:this.calculatePositionsLow,noAlloc:!0,shaderAttributes:{positions64xyLow:{offset:0,divisor:0},instancePositions64xyLow:{offset:0,divisor:1},nextPositions64xyLow:{offset:8,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:!0},elevations:{size:1,transition:R,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{alias:"colors",size:4,type:5121,transition:R,accessor:"getFillColor",defaultValue:N,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{alias:"colors",size:4,type:5121,transition:R,accessor:"getLineColor",defaultValue:N,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:function(e,n){var i=n.index,o=n.target;return t.encodePickingColor(i,o)},shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}},{key:"draw",value:function(t){var e=t.uniforms,n=this.props,i=n.extruded,o=n.filled,r=n.wireframe,s=n.elevationScale,a=this.state,l=a.topModel,c=a.sideModel,u=a.polygonTesselator,p=Object.assign({},e,{extruded:Boolean(i),elevationScale:s});c&&(c.setInstanceCount(u.instanceCount-1),c.setUniforms(p),r&&(c.setDrawMode(3),c.setUniforms({isWireframe:!0}).draw()),o&&(c.setDrawMode(6),c.setUniforms({isWireframe:!1}).draw())),l&&(l.setVertexCount(u.get("indices").length),l.setUniforms(p).draw())}},{key:"updateState",value:function(t){Object(p.a)(Object(s.a)(e.prototype),"updateState",this).call(this,t),this.updateGeometry(t);var n=t.props,i=t.oldProps,o=this.getAttributeManager();(n.fp64!==i.fp64||n.filled!==i.filled||n.extruded!==i.extruded)&&(this.state.models&&this.state.models.forEach(function(t){return t.delete()}),this.setState(this._getModels(this.context.gl)),o.invalidateAll())}},{key:"updateGeometry",value:function(t){var e=t.props,n=t.oldProps,i=t.changeFlags;if(i.dataChanged||e.fp64!==n.fp64||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){var o=this.state.polygonTesselator;o.updateGeometry({data:e.data,getGeometry:e.getPolygon,positionFormat:e.positionFormat,fp64:this.use64bitPositions()}),this.setState({numInstances:o.instanceCount,bufferLayout:o.bufferLayout}),this.getAttributeManager().invalidateAll()}}},{key:"_getModels",value:function(t){var e,n,i=this.props,o=i.id,r=i.filled,s=i.extruded;if(r){var a=this.getShaders(I);a.defines.NON_INSTANCED_MODEL=1,e=new h.a(t,Object.assign({},a,{id:"".concat(o,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0,shaderCache:this.context.shaderCache}))}return s&&((n=new h.a(t,Object.assign({},this.getShaders(F),{id:"".concat(o,"-side"),geometry:new y.a({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,1,0,1,0,0,1,0])}}}),instanceCount:0,isInstanced:1,shaderCache:this.context.shaderCache}))).userData.excludeAttributes={indices:!0}),{models:[n,e].filter(Boolean),topModel:e,sideModel:n}}},{key:"calculateIndices",value:function(t){var e=this.state.polygonTesselator;t.bufferLayout=e.indexLayout,t.value=e.get("indices")}},{key:"calculatePositions",value:function(t){var e=this.state.polygonTesselator;t.bufferLayout=e.bufferLayout,t.value=e.get("positions")}},{key:"calculatePositionsLow",value:function(t){var e=this.use64bitPositions();t.constant=!e,t.value=e?this.state.polygonTesselator.get("positions64xyLow"):new Float32Array(2)}},{key:"calculateVertexValid",value:function(t){t.value=this.state.polygonTesselator.get("vertexValid")}},{key:"clearPickingColor",value:function(t){for(var e=this.decodePickingColor(t),n=this.state.polygonTesselator.bufferLayout,i=n[e],o=0,r=0;r<e;r++)o+=n[r];var s=this.getAttributeManager().attributes.pickingColors,a=s.value,l=o+i;a.fill(0,3*o,3*l),s.update({value:a})}}]),e}(f.a);V.layerName="SolidPolygonLayer",V.defaultProps=D;var G=n(371);n.d(e,"a",function(){return H});var Z=new l.a,W={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,lineDashJustified:!1,fp64:!1,getPolygon:{type:"accessor",value:function(t){return t.polygon}},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1},getLineDashArray:{type:"accessor",value:[0,0]},getElevation:{type:"accessor",value:1e3},material:Z},H=function(t){function e(){return Object(i.a)(this,e),Object(r.a)(this,Object(s.a)(e).apply(this,arguments))}return Object(a.a)(e,t),Object(o.a)(e,[{key:"initializeState",value:function(){this.state={paths:[]}}},{key:"updateState",value:function(t){t.oldProps;var e=t.props,n=t.changeFlags;(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon))&&(this.state.paths=this._getPaths(e))}},{key:"getPickingInfo",value:function(t){var e=t.info;return Object.assign(e,{object:e.object&&e.object.object||e.object})}},{key:"_getPaths",value:function(t){var e=t.data,n=t.getPolygon,i=[],o="XY"===t.positionFormat?2:3,r=Object(c.a)(e),s=r.iterable,a=r.objectInfo,l=!0,u=!1,p=void 0;try{for(var f,v=s[Symbol.iterator]();!(l=(f=v.next()).done);l=!0){var d=f.value;a.index++;var h=j(n(d,a),o),y=h.positions,g=h.holeIndices;if(g)for(var x=0;x<=g.length;x++){var P=y.subarray(g[x-1]||0,g[x]||y.length);i.push({path:P,object:d})}else i.push({path:y,object:d})}}catch(t){u=!0,p=t}finally{try{l||null==v.return||v.return()}finally{if(u)throw p}}return i}},{key:"_getAccessor",value:function(t){return"function"==typeof t?function(e){return t(e.object)}:t}},{key:"renderLayers",value:function(){var t=this.props,e=t.data,n=t.stroked,i=t.filled,o=t.extruded,r=t.wireframe,s=t.elevationScale,a=t.transitions,l=this.props,c=l.lineWidthUnits,u=l.lineWidthScale,p=l.lineWidthMinPixels,f=l.lineWidthMaxPixels,v=l.lineJointRounded,d=l.lineMiterLimit,h=l.lineDashJustified,y=l.fp64,g=this.props,x=g.getFillColor,P=g.getLineColor,m=g.getLineWidth,b=g.getLineDashArray,L=g.getElevation,S=g.getPolygon,w=g.updateTriggers,_=g.material,C=this.state.paths,A=this.getSubLayerClass("fill",V),j=this.getSubLayerClass("stroke",G.a),O=this.shouldRenderSubLayer("fill",C)&&new A({extruded:o,elevationScale:s,fp64:y,filled:i,wireframe:r,getElevation:L,getFillColor:x,getLineColor:P,material:_,transitions:a},this.getSubLayerProps({id:"fill",updateTriggers:{getPolygon:w.getPolygon,getElevation:w.getElevation,getFillColor:w.getFillColor,getLineColor:w.getLineColor}}),{data:e,getPolygon:S});return[!o&&O,!o&&n&&this.shouldRenderSubLayer("stroke",C)&&new j({fp64:y,widthUnits:c,widthScale:u,widthMinPixels:p,widthMaxPixels:f,rounded:v,miterLimit:d,dashJustified:h,transitions:a&&{getWidth:a.getLineWidth,getColor:a.getLineColor,getPath:a.getPolygon},getColor:this._getAccessor(P),getWidth:this._getAccessor(m),getDashArray:this._getAccessor(b)},this.getSubLayerProps({id:"stroke",updateTriggers:{getWidth:w.getLineWidth,getColor:w.getLineColor,getDashArray:w.getLineDashArray}}),{data:C,getPath:function(t){return t.path}}),o&&O]}}]),e}(u.a);H.layerName="PolygonLayer",H.defaultProps=W},78:function(t,e,n){"use strict";var i=n(102),o=n(57),r=n(58),s=n(140),a=function(){function t(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).overAlloc,n=void 0===e?1:e;Object(o.a)(this,t),this.overAlloc=n}return Object(r.a)(t,[{key:"allocate",value:function(t,e,n){var i=n.size,o=n.type,r=n.copy,s=void 0!==r&&r,a=e*i;if(t&&a<=t.length)return t;var l=Math.max(Math.ceil(a*this.overAlloc),1),c=this._allocate(o,l);return t&&s&&c.set(t),this._release(t),c}},{key:"_allocate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Float32Array,e=arguments.length>1?arguments[1]:void 0;return new t(e)}},{key:"_release",value:function(t){}}]),t}(),l=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(o.a)(this,t);var n=e.attributes,i=void 0===n?{}:n;this.typedArrayManager=new a,this.indexLayout=null,this.bufferLayout=null,this.vertexCount=0,this.instanceCount=0,this.attributes={},this._attributeDefs=i,this.updateGeometry(e),Object.seal(this)}return Object(r.a)(t,[{key:"updateGeometry",value:function(t){var e=t.data,n=t.getGeometry,i=t.positionFormat,o=t.fp64;this.data=e,this.getGeometry=n,this.fp64=o,this.positionSize="XY"===i?2:3,this._rebuildGeometry()}},{key:"updatePartialGeometry",value:function(t){var e=t.startRow,n=t.endRow;this._rebuildGeometry({startRow:e,endRow:n})}},{key:"updateGeometryAttributes",value:function(t,e,n){throw new Error("Not implemented")}},{key:"getGeometrySize",value:function(t){throw new Error("Not implemented")}},{key:"_forEachGeometry",value:function(t,e,n){var i=this.data,o=this.getGeometry,r=Object(s.a)(i,e,n),a=r.iterable,l=r.objectInfo,c=!0,u=!1,p=void 0;try{for(var f,v=a[Symbol.iterator]();!(c=(f=v.next()).done);c=!0){var d=f.value;l.index++,t(o(d,l),l.index)}}catch(t){u=!0,p=t}finally{try{c||null==v.return||v.return()}finally{if(u)throw p}}}},{key:"_rebuildGeometry",value:function(t){var e=this;if(this.data&&this.getGeometry){var n=this.indexLayout,i=this.bufferLayout;t||(n=[],i=[]);var o=t||{},r=o.startRow,s=void 0===r?0:r,a=o.endRow,l=void 0===a?1/0:a;this._forEachGeometry(function(t,n){i[n]=e.getGeometrySize(t)},s,l);var c=0,u=!0,p=!1,f=void 0;try{for(var v,d=i[Symbol.iterator]();!(u=(v=d.next()).done);u=!0){c+=v.value}}catch(t){p=!0,f=t}finally{try{u||null==d.return||d.return()}finally{if(p)throw f}}var h=this.attributes,y=this._attributeDefs,g=this.typedArrayManager,x=this.fp64;for(var P in y){var m=y[P];m.copy=Boolean(t),m.fp64Only&&!x||(h[P]=g.allocate(h[P],c,m))}this.indexLayout=n,this.bufferLayout=i,this.instanceCount=c;for(var b={vertexStart:0,indexStart:0},L=0;L<s;L++)b.vertexStart+=i[L],b.indexStart+=n[L]||0;this._forEachGeometry(function(t,o){var r=i[o];b.geometryIndex=o,b.geometrySize=r,e.updateGeometryAttributes(t,b),b.vertexStart+=r,b.indexStart+=n[o]||0},s,l);for(var S=b.indexStart,w=l;w<n.length;w++)S+=n[w];this.vertexCount=S}}}]),t}(),c=n(239),u=n(191);n.d(e,"a",function(){return p});var p={Tesselator:l,flattenVertices:i.c,fillArray:i.a,count:c.a,memoize:u.a}}}]);